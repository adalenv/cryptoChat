  <meta charset="UTF-8">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
      <style type="text/css">
        
@media only screen and (min-width: 768px) {
 

input {
    border: 0;
    color: inherit;
    font-family: inherit;
    font-size: 100%;
    line-height: normal;
    margin: 0;
}

p { margin: 0; }

.clearfix { *zoom: 1; } /* For IE 6/7 */
.clearfix:before, .clearfix:after {
    content: "";
    display: table;
}
.clearfix:after { clear: both; }

/* ---------- LIVE-CHAT ---------- */

#live-chat {
    z-index:10;
    bottom: 0;
    font-size: 12px;
    right: 24px;
    position: fixed;
    width: 300px;
}

#live-chat header {
    background: #293239;
    border-radius: 5px 5px 0 0;
    color: #fff;
    padding: 16px 24px;
}

#live-chat h4:before {
    background: #1a8a34;
    border-radius: 50%;
    content: "";
    display: inline-block;
    height: 8px;
    margin: 0 8px 0 0;
    width: 8px;
}




#live-chat form {
    padding: 24px;
}

#live-chat input[type="text"] {
    border: 1px solid #ccc;
    border-radius: 3px;
    padding: 8px;
    outline: none;
    width:223px;
}


.chat-close {
    background: #1b2126;
    border-radius: 50%;
    color: #fff;
    display: block;
    float: right;
    font-size: 15px;
    height: 20px;
    line-height: 20px;
    margin: 2px 0 0 0;
    text-align: center;
    width: 20px;
}

.chat {
    background: #f3f3f3;
    display: none;
}

.chat-history {
    height: 252px;
    padding: 8px 24px;
    overflow-y: scroll;
}

.chat-message {
    margin: 16px 0;
    background: white;
    padding-left: 3px;
    padding-right: 3px;

}




.chat-time {
    float: right;
    font-size: 10px;
}

.select-style {
    padding: 0;
    margin: 0;
    border: 1px solid #ccc;
    width: 200px;
    border-radius: 3px;
    overflow: hidden;
    background-color: #fff;

    background: #fff url("http://www.scottgood.com/jsg/blog.nsf/images/arrowdown.gif") no-repeat 90% 50%;
}

.select-style select {
    padding: 5px 8px;
    width: 130%;
    border: none;
    box-shadow: none;
    background-color: transparent;
    background-image: none;
    -webkit-appearance: none;
       -moz-appearance: none;
            appearance: none;
}

.select-style select:focus {
    outline: none;
}

.select-currency {
    display: none;
}
.select-div{
    display: none;
}
.div-head{
    color: #293339;
    background: #2933397a;
    position: absolute;
    width: 300px;
    height: 24px;
    padding-left: 3px;
    padding-right: 3px; 
    font-size: small;
    font-weight: bold;
    text-align: center; 
    line-height: 2;
}
.c_price{
    display: inline;
    float: left;
    width: 40%;
    padding-left:10px;
}
.c_percent{
    display: inline;
}



.c_price_val{
    display: inline;
    color: #3875d7;
}

.c_percent_val{
    display: inline;
}
    #header-bottom{
        display: none;
    }

}

@media only screen and (max-width: 768px) {


input {
    border: 0;
    color: inherit;
    font-family: inherit;
    font-size: 100%;
    line-height: normal;
    margin: 0;
}

p { margin: 0; }

.clearfix { *zoom: 1; } /* For IE 6/7 */
.clearfix:before, .clearfix:after {
    content: "";
    display: table;
}
.clearfix:after { clear: both; }

/* ---------- LIVE-CHAT ---------- */

#live-chat {
    z-index:10;
    bottom: 0;
    font-size: 12px;
    right: 24px;
    position: fixed;
    width: 300px;
}

#live-chat header {
    background: #293239;
    border-radius: 5px 5px 0 0;
    color: #fff;
    padding: 16px 24px;
}

#live-chat h4:before {
    background: #1a8a34;
    border-radius: 50%;
    content: "";
    display: inline-block;
    height: 8px;
    margin: 0 8px 0 0;
    width: 8px;
}



#live-chat form {
    padding: 24px;
}

#live-chat input[type="text"] {
    border: 1px solid #ccc;
    border-radius: 3px;
    padding: 8px;
    outline: none;
    width:223px;
}


.chat-close {
    background: #1b2126;
    border-radius: 50%;
    color: #fff;
    display: block;
    float: right;
    font-size: 15px;
    height: 20px;
    line-height: 20px;
    margin: 2px 0 0 0;
    text-align: center;
    width: 20px;
}

.chat {
    background: #f3f3f3;
    display: none;
}

.chat-history {
    height: 252px;
    padding: 8px 24px;
    overflow-y: scroll;
}

.chat-message {
    margin: 16px 0;
    background: white;
    padding-left: 3px;
    padding-right: 3px;

}




.chat-time {
    float: right;
    font-size: 10px;
}

.select-style {
    padding: 0;
    margin: 0;
    border: 1px solid #ccc;
    width: 200px;
    border-radius: 3px;
    overflow: hidden;
    background-color: #fff;

    background: #fff url("http://www.scottgood.com/jsg/blog.nsf/images/arrowdown.gif") no-repeat 90% 50%;
}

.select-style select {
    padding: 5px 8px;
    width: 130%;
    border: none;
    box-shadow: none;
    background-color: transparent;
    background-image: none;
    -webkit-appearance: none;
       -moz-appearance: none;
            appearance: none;
}

.select-style select:focus {
    outline: none;
}

.select-currency {
    display: none;
}
.select-div{
    display: none;
}
.div-head{
    color: #293339;
    background: #2933397a;
    position: absolute;
    width: 300px;
    height: 24px;
    padding-left: 3px;
    padding-right: 3px; 
    font-size: small;
    font-weight: bold;
    text-align: center;
    line-height: 2;
    border-top: 1px solid #293339;
    border-radius: 3px 3px 0 0;
}
.c_price{
    display: inline;
    float: left;
    width: 40%;
    padding-left:10px;
}
.c_percent{
    display: inline;
}



.c_price_val{
    display: inline;
    color: #3875d7;
}

.c_percent_val{
    display: inline;
}
    #header-bottom{
        display: none;
    }

    /* For mobile phones: */
    #header-top{
        display: none;
    }
    #header-bottom{
        display: block;
         border-radius: 0px;
    }
    #live-chat{
        width: 100%;
        right: 0px;
    }
    .div-head{
        width: 100%;
    }
    #live-chat header {
        border-radius: 0  !important;
    }
    #live-chat input[type="text"]{
        width: 90%;
    }

}

.chat-message-content h5{
    font-size: 15px;
    color:black;
    margin: 0 0 5px;
}
.chat-message-content p {
    color: black;
    font-size: 12px
}

.chat_title{
    color: white;
}

</style>

 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700">



    <div id="live-chat">
         
        <header class="clearfix" id="header-top">
            
            <a href="#" class="chat-close">˅</a>

                <div class="select-div">
                    <select   class="select-currency select-style" id="select-currency">
                        
                    </select>
                </div>

                <h4 class="chat_title" style="display: none;">Chat</h4>

        

        </header>
        <div class="div-head">

                <div class="c_price">Price:
                    <div class="c_price_val">
                        
                    </div>
                </div>

                <div class="c_percent">Change 24h:
                    <div class="c_percent_val">
                        
                    </div>
                </div>

            
        </div>
        <div class="chat">
            
            <div class="chat-history">



            </div> <!-- end chat-history -->


            <form >

                <fieldset>
                    
                    <input type="text" class="message-text" placeholder="Type your message and press enter…" autofocus>
                     <img style="height: 25px;width: 25px" class="send_message_btn" src="http://www.centralpostmedia.com/wp-content/uploads/2016/06/Open-3.png">

                </fieldset>

            </form>

        </div> <!-- end chat -->
            <header class="clearfix" id="header-bottom">
            
            <a href="#" class="chat-close">˅</a>

                <div class="select-div">
                    <select   class="select-currency select-style" id="select-currency">
                        
                    </select>
                </div>

                <h4 class="chat_title" style="display: none;">Chat</h4>

        

        </header>

    </div> <!-- end live-chat -->



    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2-bootstrap-css/1.4.6/select2-bootstrap.min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
</html>
    
</body>
</html>
  
  

<script >
//made by Adalen VLADI

back_url='/cryptoChat/back/';
app={
    var:{

        <?php
            $current_user = wp_get_current_user();
            //print_r($current_user);
            if ( 0 == $current_user->ID ) {
               
                echo "user:localStorage.getItem('wp_user'),";
            } else {
                echo "user:\"".$current_user->user_login."\",";
            }
            ?>
        
        currency:localStorage.getItem('currency'),
        last_msg_id:'null',
    },

    function:{
        firstRun:function(currency){
            $.ajax({
                url: back_url,
                type: 'POST',
                dataType: 'json',
                data: {
                    currency: currency,
                    function:'first_run' 
                }
            })
            .done(function(data) {
                $('.chat-history').html('');
                if(typeof data !== 'undefined' && data.length >0){
                    app.var.last_msg_id=data[data.length-1].id;
                    app.function.displayMessages(data,'first_run');
                }
            })
            .fail(function() {
                console.log("error");
            })          
        },//firstrun end

        getMessages:function(currency){
            $.ajax({
                url: back_url,
                type: 'POST',
                dataType: 'json',
                data: {
                    currency: currency,
                    function:'get_messages',
                    last_msg_id:app.var.last_msg_id
                }
            })
            .done(function(data) {
                if(typeof data !== 'undefined' && data.length >0){
                    //console.log(data);
                    app.var.last_msg_id=data[data.length-1].id;
                    app.function.displayMessages(data,'new');
                    //console.clear();
                }
            })
            .fail(function() {
                console.log("error");
            })
            
        },//getMessage end 

        displayMessages:function(data,type){

                            
    
                    for (var i = 0; i < data.length; i++) {
                        $('.chat-history').append('<div class="chat-message clearfix" style="background:'+stringToColour(data[i].user)+'26'+'" id="msg_id'+data[i].id+'">'+

                                '<div class="chat-message-content clearfix">'+
                                    
                                    '<span class="chat-time">'+data[i].datetime+'</span>'+

                                    '<h5>'+data[i].user+'</h5>'+

                                    '<p>'+data[i].text+'</p>'+

                                '</div> '+

                            '</div>'
                            );
                    }//for end

                $('.chat-history').scrollTop($('.chat-history')[0].scrollHeight);

            

        },//display messages end
        sendMessage:function(){
            if ($('.message-text').val().length>0) {
                $.ajax({
                    url: back_url,
                    type: 'POST',
                    data: {
                        user: app.var.user,
                        currency:app.var.currency,
                        message:$('.message-text').val(),
                        function:'send_message'
                    },
                })
                .done(function() {
                    $('.message-text').val('');
                    //app.function.getMessages(app.var.currency);
                })
                .fail(function() {
                    console.log("error");
                })
            }
            
        },//sendmessage end

        setCurrency:function(currency){
            app.var.currency=currency;
            app.var.last_msg_id='null';
            localStorage.setItem('currency',currency);
            app.function.firstRun(app.var.currency);
            $('.c_price_val').html($('.select-currency [value="'+currency+'"]').attr('data-price_atr'));
            $('.c_percent_val').html($('.select-currency [value="'+currency+'"]').attr('data-percent_atr')+'%');
            if ($('.select-currency [value="'+app.var.currency+'"]').attr('data-percent_atr') <0) {
                    $('.c_percent_val').css('color','#e62727');
                } else{
                    $('.c_percent_val').css('color','#1a8a34');
                }

            
        },//setcurrency end
        getFromMarketCap:function(){
            $.ajax({
                url: 'https://api.coinmarketcap.com/v1/ticker/?limit=20000',
                type: 'GET',
                dataType: 'json',
                //data: {param1: 'value1'},
            })
            .done(function(data) {
                for (var i = 0 ; i < data.length; i++) {
                    $('.select-currency').append('<option data-price_atr="'+data[i].price_usd+'" data-percent_atr="'+data[i].percent_change_24h+'"   value="'+data[i].id+'">'+data[i].name+'</option>')
                }
                $('.select-currency').val(app.var.currency);
                $('.c_price_val').html($('.select-currency [value="'+app.var.currency+'"]').attr('data-price_atr'));
                $('.c_percent_val').html($('.select-currency [value="'+app.var.currency+'"]').attr('data-percent_atr')+'%');

                if ($('.select-currency [value="'+app.var.currency+'"]').attr('data-percent_atr') <0) {
                    $('.c_percent_val').css('color','#e62727');
                } else{
                    $('.c_percent_val').css('color','#1a8a34');
                }



            })
            .fail(function() {
                console.log("error");
            })
            
        }//getfrommarketcap end

    }



};


(function() {

app.function.getFromMarketCap();

if (typeof(Storage) !== "undefined") {

if (localStorage.getItem('currency')==null) {
    app.var.currency='bitcoin';
};



if (localStorage.getItem('wp_user')==null) {
    localStorage.setItem('wp_user','guest'+Math.floor(1000 + Math.random() * 9000));
    app.var.user=localStorage.getItem('wp_user');
};

 if (localStorage.getItem('chatOpen')==null){
    localStorage.setItem('chatOpen','no');
 }


checkChat();


} else {
    // Sorry! No Web Storage support..
}

function checkChat(){
        if (typeof(Storage) !== "undefined") {

        if (localStorage.chatOpen) {
          if (localStorage.getItem('chatOpen')=='yes') {//if was open
            $('.chat-close').html('˅');
            $('.chat_title').hide();
            $('.select-currency').show();
            $('.select-div').show();
            $('.div-head').show();
            $('.chat').show();
            //$('.chat').slideUp('slow');//open it
            //console.log(localStorage.getItem('chatOpen'));
          } else if (localStorage.getItem('chatOpen')=='no')  {

            $('.chat-close').html('˄');
            $('.chat_title').show();
            $('.select-currency').hide();
            $('.div-head').hide();
            $('.select-div').hide();
            //$('.chat').slideDown('slow');//open it
            $('.chat').hide();
          }
          
      } else {
         // localStorage.chatOpen='no';
      }

    } else {
        // Sorry! No Web Storage support..
    }
}



                $('.select-currency').select2({
                  placeholder:app.var.currency,
                });



    $('.chat-close').on('click', function(e) {
        if (localStorage.getItem('chatOpen')=='no') {
            localStorage.setItem('chatOpen','yes')
            //$('.chat').slideDown('slow');//open it
            //console.log('from no to yes');
          } else if (localStorage.getItem('chatOpen')=='yes') {
            localStorage.setItem('chatOpen','no');
            //console.log('from yes to no');
          }
            checkChat();
            //console.log('from no to yes');
    
    });


    $('.select-currency').on('change', function() {
        app.function.setCurrency(this.value );
        // $('.select-currency').attr('size', '1');
    })


    app.function.firstRun(app.var.currency);


    setInterval(function(){ 
        app.function.getMessages(app.var.currency);
       // console.clear();

    },3000); 

    $('.message-text').keypress(function (e) {

      if (e.which == 13 && $('.message-text').val().length >0) {
            e.preventDefault();
            app.function.sendMessage();

        return false;    //<---- Add this line
    setInterval(function(){ 


    },1000); 
 
      } else if(e.which == 13 && $('.message-text').val().length <1) {
        e.preventDefault();
      }


    });

    $('.send_message_btn').on('click',function(){
        
        app.function.sendMessage();
            setInterval(function(){ 


    },1000); 
        $('.message-text').focus();
    });


 stringToColour = function(str) {
  var hash = 0;
  for (var i = 0; i < str.length; i++) {
    hash = str.charCodeAt(i) + ((hash << 5) - hash);
  }
  var colour = '#';
  for (var i = 0; i < 3; i++) {
    var value = (hash >> (i * 8)) & 0xFF;
    colour += ('00' + value.toString(16)).substr(-2);
  }
  return colour;
}


}) ();

    </script>




</body>

</html>
